<!DOCTYPE html>
<!-- saved from url=(0059)https://docker-runner.docs.drone.io/configuration/services/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Services | Drone</title>


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="copyright" content="">

<link rel="icon" type="image/png" sizes="32x32" href="https://docker-runner.docs.drone.io/favicon.png">
<link rel="stylesheet" href="./Services _ Drone_files/docsearch.min.css">
<link rel="stylesheet" href="./Services _ Drone_files/style.css">
<link rel="stylesheet" href="./Services _ Drone_files/css">





  </head>
  <body>
        <header class="header">
        <div class="branding">
            <button class="menu" aria-hidden="true"></button>
            <a class="logo" href="https://docker-runner.docs.drone.io/" aria-label="Documentation">
                <img src="./Services _ Drone_files/logo.svg">
            </a>
        </div>
        <div class="search">
            <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"><input type="text" class="aa-hint" readonly="" aria-hidden="true" autocomplete="off" spellcheck="false" tabindex="-1" style="position: absolute; top: 0px; left: 0px; border-color: transparent; box-shadow: none; opacity: 1; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(255, 255, 255, 0.1);"><input type="text" id="search-input" placeholder="Search the Drone Docker Runner documentation ..." class="aa-input" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="both" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: system-ui; font-size: 15px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="aa-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="aa-dataset-1"></div></span></span>
        </div>
    </header>
    <section class="sidebar">
    <header aria-hidden="true">
        <button class="close"></button>
    </header>
    <div class="back">
        <a href="https://docs.drone.io/">Main Documentation</a>
    </div>
    <div class="title">
        <a href="https://docker-runner.docs.drone.io/">Docker runner</a>
    </div>
    





<nav class="tree">

    <ul>
    
    

    

    

    
    <li>
        <details>
            <summary>
                <a href="https://docker-runner.docs.drone.io/installation/">Installation</a>
            </summary>
            <ul>
            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/installation/install_linux/">Install on Linux</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/installation/install_windows/">Install on Windows</a>
    </li>
    

            

            
            
    

    

    
    <li class="hide_children">
        <a href="https://docker-runner.docs.drone.io/installation/reference/">Configuration Reference</a>
    </li>
    

            
            </ul>
        </details>
    </li>
    

    </ul>
    
    <ul>
    
    

    

    

    
    <li>
        <details open="">
            <summary>
                <a href="https://docker-runner.docs.drone.io/configuration/">Configuration</a>
            </summary>
            <ul>
            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/overview/">Overview</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/trigger/">Triggers</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/platform/">Platform</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/workspace/">Workspace</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/cloning/">Cloning</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/steps/">Steps</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/plugins/">Plugins</a>
    </li>
    

            
            
    

    

    
    <li class="selected active">
        <a href="https://docker-runner.docs.drone.io/configuration/services/">Services</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/images/">Images</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/parallelism/">Parallelism</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/conditions/">Conditions</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/routing/">Routing</a>
    </li>
    

            

            
            
    

    

    

    
    <li>
        <details>
            <summary>
                <a href="https://docker-runner.docs.drone.io/configuration/environment/">Environment</a>
            </summary>
            <ul>
            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/environment/overview/">Environment</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/environment/substitution/">Substitution</a>
    </li>
    

            

            
            
    

    

    
    <li class="hide_children">
        <a href="https://docker-runner.docs.drone.io/configuration/environment/variables/">Environment Reference</a>
    </li>
    

            
            </ul>
        </details>
    </li>
    

            
            
    

    

    

    
    <li>
        <details>
            <summary>
                <a href="https://docker-runner.docs.drone.io/configuration/volumes/">Volumes</a>
            </summary>
            <ul>
            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/volumes/host/">Host Volumes</a>
    </li>
    

            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/configuration/volumes/temporary/">Temporary Volumes</a>
    </li>
    

            

            
            </ul>
        </details>
    </li>
    

            
            </ul>
        </details>
    </li>
    

    </ul>
    
    <ul>
    
    

    

    
    <li class="hide_children">
        <a href="https://docker-runner.docs.drone.io/specification/">Specification</a>
    </li>
    

    </ul>
    
    <ul>
    
    

    

    

    
    <li>
        <details>
            <summary>
                <a href="https://docker-runner.docs.drone.io/examples/">Examples</a>
            </summary>
            <ul>
            

            
            
    

    

    
    <li class="hide_children">
        <a href="https://docker-runner.docs.drone.io/examples/language/">Languages</a>
    </li>
    

            
            
    

    

    
    <li class="hide_children">
        <a href="https://docker-runner.docs.drone.io/examples/service/">Services</a>
    </li>
    

            
            </ul>
        </details>
    </li>
    

    </ul>
    
    <ul>
    
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/support/">Support</a>
    </li>
    

    </ul>
    
    <ul>
    
    

    

    

    
    <li>
        <details>
            <summary>
                <a href="https://docker-runner.docs.drone.io/questions/">Questions</a>
            </summary>
            <ul>
            
            
    

    

    
    <li>
        <a href="https://docker-runner.docs.drone.io/questions/usage/how-to-limit-concurrency/"></a>
    </li>
    

            

            
            </ul>
        </details>
    </li>
    

    </ul>
    
</nav>

</section>

    <main>
        <article>
            <header>
                <div class="breadcrumb">
    <div class="crumb">
        <a href="https://docker-runner.docs.drone.io/">Docker runner</a>
    </div>
    
        <div class="crumb">
            <a href="https://docker-runner.docs.drone.io/configuration/">Configuration</a>
        </div>
        
</div>

                <h1>Services</h1>
            </header>
            <section class="content">

<p>Drone supports launching detached service containers as part of your pipeline. The typical use case for services is when your unit tests require a running redis server, for example:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tbody><tr><td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="hl"><span class="lnt">5
</span></span><span class="hl"><span class="lnt">6
</span></span><span class="hl"><span class="lnt">7
</span></span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">kind: pipeline
type: docker
name: default

<span class="hl">services:
</span><span class="hl">- name: cache
</span><span class="hl">  image: redis</span></code></pre></td></tr></tbody></table>
</div>
</div>

<p>Service containers are reachable at a hostname identical to the container name. In our previous example, the redis container name is <em>cache</em>, and can be accessed from the pipeline at <code>tcp://redis:6379</code></p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tbody><tr><td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="hl"><span class="lnt"> 9
</span></span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">kind: pipeline
type: docker
name: default

steps:
- name: ping
  image: redis
  commands:
<span class="hl">  - redis-cli -h cache ping
</span>
services:
- name: cache
  image: redis</code></pre></td></tr></tbody></table>
</div>
</div>

<p>It is important to note the service container exit code is ignored, and a non-zero exit code does not fail the overall pipeline. Drone expects service containers to exit with a non-zero exit code, since they often need to be killed after the pipeline completes.</p>

<h1 id="detached-steps">Detached Steps</h1>

<p>Services can also be defined directly in the pipeline, as detached pipeline steps. This can be useful when you need direct control over when the service is started, relative to other steps in your pipeline.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tbody><tr><td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">kind: pipeline
name: default

steps:
- name: redis
  image: redis
<span class="hl">  detach: true
</span>
- name: ping
  image: redis
  commands:
  - redis-cli -h cache ping</code></pre></td></tr></tbody></table>
</div>
</div>

<h1 id="common-problems">Common Problems</h1>

<p>This section highlights some common problems that users encounter when configuring services. If you continue to experience issues please also check the faq. You might also want to compare your yaml to our example service configurations.</p>

<h2 id="incorrect-hostname">Incorrect Hostname</h2>

<p>It is import to remember that you cannot use the <code>localhost</code> or <code>127.0.0.1</code> address to connect to services from your pipeline. Service containers are assigned their own IP address and hostname. The hostname is based on the service container name.</p>

<div class="highlight"><pre class="chroma"><code class="language-patch" data-lang="patch">kind: pipeline
type: docker
name: default

steps:
  - name: ping
    image: redis
    commands:
<span class="gd">-   - redis-cli -h 127.0.0.1 ping
</span><span class="gd"></span><span class="gi">+   - redis-cli -h cache ping
</span><span class="gi"></span>
services:
  - name: cache
    image: redis
</code></pre></div>

<h2 id="initialization">Initialization</h2>

<p>It is important to remember that after a container is started, the software running inside the container (e.g. redis) takes time to initialize and begin accepting connections.</p>

<p>Be sure to give the service adequate time to initialize before attempting to connect. A naive solution is to use the sleep command.</p>

<div class="highlight"><pre class="chroma"><code class="language-patch" data-lang="patch">kind: pipeline
type: docker
name: default

steps:
  - name: ping
    image: redis
    commands:
<span class="gi">+   - sleep 5
</span><span class="gi"></span>    - redis-cli -h cache ping

services:
  - name: cache
    image: redis
</code></pre></div>
</section>
            <footer class="next-prev">
    
    <a href="https://docker-runner.docs.drone.io/configuration/plugins/" class="prev">
        <span class="icon"></span>
        <span class="type">Previous</span>
        <span class="name">Plugins</span>
    </a>
    

    
    <a href="https://docker-runner.docs.drone.io/configuration/images/" class="next">
        <span class="type">Next</span>
        <span class="name">Images</span>
        <span class="icon"></span>
    </a>
    
</footer>
        </article>

        <aside>
    
</aside>
    </main>
    
<div class="overlay" aria-hidden="true"></div>


<script>
    function toggle(el) {
        if (el.classList.contains("open")) {
            el.classList.remove("open");
        } else {
            el.classList.add("open");
        }
    };
    function toggleSidebar(e) {
        toggle(document.querySelector(".sidebar"));
        toggle(document.querySelector(".overlay"));
    }
    document.querySelector(".overlay").addEventListener("click", toggleSidebar);
    document.querySelector("header .menu").addEventListener("click", toggleSidebar);
    document.querySelector(".sidebar header button").addEventListener("click", toggleSidebar);
</script>


<script src="./Services _ Drone_files/autocomplete.js"></script>
<script src="./Services _ Drone_files/fuse.js"></script>
<script>
var options = {
  shouldSort: true,
  tokenize: false,
  threshold: 0.6,
  location: 0,
  distance: 100,
  maxPatternLength: 32,
  minMatchCharLength: 1,
  keys: [
    "title",
    "tags",
    "content"
  ]
};

var index;
autocomplete('#search-input', {
    hint: true,
    debounce: 250,
    cache: true,
    debug: window.location.hostname === "localhost",
}, [
    {
        displayKey: function(suggestion) {
            return suggestion.title
        },
        source: function(query, callback) {
            if (!index) {
                fetch("/index.json")
                .then(function(response) {
                    return response.json();
                })
                .then(function(items) {
                    index = new Fuse(items, options);
                    var results = index.search(query);
                    callback(results && results.slice(0, 5));
                });
            } else {
                var results = index.search(query);
                callback(results && results.slice(0, 5));
            }
        }
    }]).on('autocomplete:selected', function(event, suggestion, dataset) {
        window.location.href = suggestion.permalink;
    });
</script>

  

</body></html>